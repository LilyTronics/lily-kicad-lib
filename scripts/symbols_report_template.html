<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<style>
body {
    margin: 0;
    padding: 16px;
    font-family: sans-serif;
    font-size: 14px;
}
table {
    border-collapse: collapse;
}
th, td {
    padding: 4px 8px;
    border: 1px solid #666;
    text-align: left;
}
th {
    background-color: #666;
    color: #fff;
}
tr:nth-child(odd) {
    background-color: #eee;
}
input {
    font-size: 14px;
}
</style>
<script>

const fields = $fields;

const symbols = [
$symbols_data
];

function showData(e) {
    document.getElementById("total_filtered").innerHTML = "";
    let query = "";
    let total_filtered = 0;
    if (e) {
        query = e.target.value;
    }
    let output = "";
    output += "<tr>";
    output += "<th>#</th>";
    for (const field of fields) {
        output += "<th>" + escapeHtml(field) + "</th>";
    }
    output += "</tr>\n";
    let i = 1;
    for (const symbol of symbols) {
        let add_symbol = true;
        if (query != "") {
            add_symbol = false;
            for (const field of fields) {
                if (symbol[field].toLowerCase().includes(query.toLowerCase())) {
                    add_symbol = true;
                    break;
                }
            }
        }
        if (add_symbol) {
            output += "<tr>";
            output += "<td>" + i + "</td>";
            for (const field of fields) {
                output += "<td>" + escapeHtml(symbol[field]) + "</td>";
            }
            output += "</tr>\n";
            i++;
            total_filtered++;
        }
    }
    if (query != "") {
        document.getElementById("total_filtered").innerHTML = total_filtered + " found";
    }
    document.getElementById("symbol_table").innerHTML = output;
}

function escapeHtml(unsafe) {
    return unsafe
        .replace(/&/g, "&amp;")
        .replace(/</g, "&lt;")
        .replace(/>/g, "&gt;")
        .replace(/"/g, "&quot;")
        .replace(/'/g, "&#039;");
}

</script>
</head>
<body>
<h1>Lily KiCad library symbols</h1>
<p>Last updated: $timestamp</p>
<p>Total symbols: $total</p>
<p>Filter: <input type="text" id="query" style="width:300px;"/> <span id="total_filtered"></span></p>
<table id="symbol_table">
</table>
<script>
showData();
const input = document.getElementById("query");
input.addEventListener("input", showData);
</script>
</body>
</html>
